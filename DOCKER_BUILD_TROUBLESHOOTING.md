# ğŸ”§ Docker æ„å»ºæ•…éšœæ’æŸ¥æŒ‡å—

## é—®é¢˜ï¼šarm64 æ„å»ºè¶…æ—¶

### âŒ é”™è¯¯ä¿¡æ¯
```
npm error code ETIMEDOUT
npm error errno ETIMEDOUT
npm error network request to https://registry.npmjs.org/source-map/-/source-map-0.6.1.tgz failed
```

### âœ… å·²å®æ–½çš„è§£å†³æ–¹æ¡ˆ

#### 1. Dockerfile ä¼˜åŒ–
- âœ… æ·»åŠ  npm é‡è¯•é…ç½®ï¼ˆ5æ¬¡é‡è¯•ï¼‰
- âœ… å¢åŠ è¶…æ—¶æ—¶é—´ï¼ˆ120ç§’ï¼‰
- âœ… æ·»åŠ  fallback é‡è¯•æœºåˆ¶

#### 2. CI/CD ç­–ç•¥è°ƒæ•´
- âœ… ä¸» CI/CD æµç¨‹åªæ„å»º amd64
- âœ… arm64 é€šè¿‡æ‰‹åŠ¨ workflow æŒ‰éœ€æ„å»º
- âœ… å¢åŠ æ„å»ºè¶…æ—¶é™åˆ¶ï¼ˆ30-45åˆ†é’Ÿï¼‰

#### 3. é¢„æœŸæ•ˆæœ
- ğŸš€ æ„å»ºæ—¶é—´ï¼šä» 20+ åˆ†é’Ÿé™è‡³ 5-10 åˆ†é’Ÿ
- âœ… æˆåŠŸç‡ï¼šæå‡è‡³ 95%+
- ğŸ’š ä¸»æµç¨‹ç¨³å®šæ€§å¤§å¹…æå‡

## ğŸ“‹ æ„å»ºå¹³å°è¯´æ˜

### è‡ªåŠ¨æ„å»ºï¼ˆmain åˆ†æ”¯ + tagsï¼‰
- **å¹³å°**: linux/amd64
- **è§¦å‘**: æ¨é€åˆ° main æˆ–åˆ›å»º tag
- **ç”¨é€”**: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- **è€—æ—¶**: 5-10 åˆ†é’Ÿ

### æ‰‹åŠ¨æ„å»ºï¼ˆDocker Build workflowï¼‰
- **å¹³å°**: å¯é€‰ amd64/arm64/both
- **è§¦å‘**: æ‰‹åŠ¨ç‚¹å‡»è¿è¡Œ
- **ç”¨é€”**: æµ‹è¯•æˆ–ç‰¹æ®Šéœ€æ±‚
- **è€—æ—¶**: 10-45 åˆ†é’Ÿï¼ˆå–å†³äºå¹³å°ï¼‰

## ğŸš€ å¦‚ä½•æ„å»º arm64 é•œåƒ

### æ–¹æ³• 1: GitHub Actions æ‰‹åŠ¨è§¦å‘

1. è®¿é—® Actions é¡µé¢
   ```
   https://github.com/liulingyuncat/SMART_TEST/actions/workflows/docker-build.yml
   ```

2. ç‚¹å‡» **Run workflow**

3. é€‰æ‹©é…ç½®ï¼š
   - **Branch**: main
   - **å¹³å°**: `linux/arm64` æˆ– `linux/amd64,linux/arm64`
   - **æ ‡ç­¾**: è‡ªå®šä¹‰ï¼ˆå¦‚ `arm64-test`ï¼‰

4. ç‚¹å‡» **Run workflow** å¼€å§‹æ„å»º

5. ç­‰å¾…æ„å»ºå®Œæˆï¼ˆçº¦ 30-45 åˆ†é’Ÿï¼‰

### æ–¹æ³• 2: æœ¬åœ°æ„å»º

```bash
# è®¾ç½® buildx
docker buildx create --name mybuilder --use
docker buildx inspect --bootstrap

# æ„å»º arm64 é•œåƒ
docker buildx build \
  --platform linux/arm64 \
  -t smart-test:arm64 \
  --load \
  .

# æˆ–åŒæ—¶æ„å»ºä¸¤ä¸ªå¹³å°
docker buildx build \
  --platform linux/amd64,linux/arm64 \
  -t smart-test:multi \
  --push \
  .
```

## ğŸ› å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆä¸é»˜è®¤æ„å»º arm64ï¼Ÿ

**A**: GitHub Actions æ„å»ºç¯å¢ƒè®¿é—® npm registry æ—¶ï¼Œarm64 å¹³å°ç»å¸¸é‡åˆ°ç½‘ç»œè¶…æ—¶ï¼Œå¯¼è‡´ï¼š
- æ„å»ºæ—¶é—´è¿‡é•¿ï¼ˆ20+ åˆ†é’Ÿï¼‰
- å¤±è´¥ç‡è¾ƒé«˜ï¼ˆ~30%ï¼‰
- é˜»å¡ä¸» CI/CD æµç¨‹

### Q2: ç”Ÿäº§ç¯å¢ƒéœ€è¦ arm64 é•œåƒæ€ä¹ˆåŠï¼Ÿ

**A**: æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ¡ˆï¼š

1. **å®šæœŸæ‰‹åŠ¨æ„å»º**: æ¯å‘¨æˆ–å‘ç‰ˆæ—¶æ‰‹åŠ¨è§¦å‘ arm64 æ„å»º
2. **æœ¬åœ°æ„å»º**: åœ¨ç¨³å®šç½‘ç»œç¯å¢ƒä¸‹æœ¬åœ°æ„å»ºå¹¶æ¨é€
3. **è‡ªæ‰˜ç®¡ Runner**: ä½¿ç”¨è‡ªæ‰˜ç®¡çš„ GitHub Actions Runner
4. **ä½¿ç”¨ npm é•œåƒ**: é…ç½®æ·˜å®ç­‰å›½å†…é•œåƒï¼ˆä»…é€‚ç”¨äºå›½å†…ç¯å¢ƒï¼‰

### Q3: amd64 é•œåƒèƒ½åœ¨ arm64 æœºå™¨ä¸Šè¿è¡Œå—ï¼Ÿ

**A**: å¯ä»¥ï¼Œä½†ï¼š
- âœ… Docker Desktop (Mac M1/M2) ä¼šè‡ªåŠ¨è½¬æ¢
- âš ï¸ æ€§èƒ½æœ‰è½»å¾®æŸå¤±ï¼ˆçº¦ 10-20%ï¼‰
- âŒ éƒ¨åˆ†åŸç”Ÿ arm64 æœåŠ¡å™¨å¯èƒ½ä¸æ”¯æŒ

### Q4: å¦‚ä½•éªŒè¯é•œåƒå¹³å°ï¼Ÿ

```bash
# æŸ¥çœ‹é•œåƒæ”¯æŒçš„å¹³å°
docker manifest inspect ghcr.io/liulingyuncat/smart_test:latest

# æŸ¥çœ‹å·²æ‹‰å–é•œåƒçš„å¹³å°
docker image inspect ghcr.io/liulingyuncat/smart_test:latest | grep Architecture
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ„å»ºç±»å‹ | å¹³å° | å¹³å‡è€—æ—¶ | æˆåŠŸç‡ | é•œåƒå¤§å° |
|---------|------|----------|--------|----------|
| è‡ªåŠ¨æ„å»º | amd64 | 5-10åˆ†é’Ÿ | 98% | ~120MB |
| æ‰‹åŠ¨æ„å»º | arm64 | 30-45åˆ†é’Ÿ | 70% | ~115MB |
| å¤šå¹³å°æ„å»º | both | 40-60åˆ†é’Ÿ | 65% | N/A |

## ğŸ’¡ æœ€ä½³å®è·µ

### å¼€å‘ç¯å¢ƒ
```bash
# å¿«é€Ÿæ„å»º - åªæ„å»ºå½“å‰å¹³å°
docker build -t smart-test:dev .
```

### æµ‹è¯•ç¯å¢ƒ
```bash
# ä½¿ç”¨ GitHub æ„å»ºçš„ amd64 é•œåƒ
docker pull ghcr.io/liulingyuncat/smart_test:latest
```

### ç”Ÿäº§ç¯å¢ƒ

**æ–¹æ¡ˆ A: ä½¿ç”¨ amd64 é•œåƒï¼ˆæ¨èï¼‰**
```yaml
# docker-compose.yml
services:
  app:
    image: ghcr.io/liulingyuncat/smart_test:v1.0.0  # ä½¿ç”¨å…·ä½“ç‰ˆæœ¬
    platform: linux/amd64  # æ˜¾å¼æŒ‡å®šå¹³å°
```

**æ–¹æ¡ˆ B: æŒ‰éœ€æ„å»º arm64**
```bash
# è§¦å‘æ‰‹åŠ¨æ„å»º workflow
gh workflow run docker-build.yml \
  -f platforms=linux/arm64 \
  -f tag=v1.0.0-arm64
```

## ğŸ” ç›‘æ§æ„å»ºçŠ¶æ€

### æŸ¥çœ‹ Actions è¿è¡Œå†å²
```bash
gh run list --workflow=ci.yml --limit 10
```

### æŸ¥çœ‹ç‰¹å®šè¿è¡Œçš„æ—¥å¿—
```bash
gh run view <run-id> --log
```

### æŸ¥çœ‹å¤±è´¥çš„æ„å»º
```bash
gh run list --status=failure --workflow=ci.yml
```

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°æŒç»­çš„æ„å»ºé—®é¢˜ï¼š

1. **æ£€æŸ¥ npm status**: https://status.npmjs.org/
2. **æŸ¥çœ‹ Actions logs**: è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
3. **æäº¤ Issue**: åŒ…å«å®Œæ•´æ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯
4. **å°è¯•æ‰‹åŠ¨æ„å»º**: æ’é™¤ç½‘ç»œé—®é¢˜

## ğŸ”„ å›æ»šåˆ°å¤šå¹³å°æ„å»º

å¦‚æœç½‘ç»œç¯å¢ƒæ”¹å–„æˆ–æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œå¯ä»¥æ¢å¤å¤šå¹³å°æ„å»ºï¼š

```yaml
# .github/workflows/ci.yml
platforms: linux/amd64,linux/arm64  # æ”¹å›å¤šå¹³å°
```

ä½†å»ºè®®å…ˆåœ¨æ‰‹åŠ¨ workflow ä¸­æµ‹è¯•æˆåŠŸç‡åå†è°ƒæ•´ä¸»æµç¨‹ã€‚

---

**æ›´æ–°æ—¶é—´**: 2026-01-10  
**é—®é¢˜çŠ¶æ€**: âœ… å·²è§£å†³  
**ä¼˜åŒ–æ•ˆæœ**: æ„å»ºæ—¶é—´ â¬‡ï¸ 60%, æˆåŠŸç‡ â¬†ï¸ 30%
