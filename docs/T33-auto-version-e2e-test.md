# 自动化测试用例版本管理 E2E 测试清单

## 测试目标
验证自动化测试用例版本管理功能的完整流程，包括版本保存、列表展示、下载、备注编辑和删除操作。

## 测试环境
- **后端服务**: http://localhost:8080
- **前端应用**: http://localhost:3000
- **测试项目**: 项目ID = 1
- **测试角色**: PM 或 PM Member

## 前置条件
1. 后端服务已启动，数据库迁移已执行
2. 前端应用已启动，用户已登录
3. 项目中至少存在部分自动化测试用例（ROLE1-4任意）
4. 用户具有 PM 或 PM Member 权限
5. storage/versions/auto-cases/ 目录已创建且具有写权限

---

## 测试场景 1: 版本保存与自动跳转

### 操作步骤
1. 进入项目详情页 -> 自动化测试用例 Tab
2. 切换到 ROLE1 Tab
3. 点击顶部"保存版本"按钮（SaveOutlined 图标）

### 预期结果
- ✅ 显示 loading 状态（按钮禁用）
- ✅ 请求成功后弹出 success 提示消息
- ✅ 自动切换到"版本管理" Tab
- ✅ 版本管理列表中显示新保存的版本记录

### 验证点
- 版本ID格式：`项目名称_YYYYMMDD_HHMMSS`
- 版本文件名列显示4个文件（role1-4.xlsx）
- 每个文件显示文件大小和用例数量
- 创建时间与当前时间一致

---

## 测试场景 2: 版本列表展示

### 操作步骤
1. 点击"版本管理" Tab
2. 观察表格列结构和数据

### 预期结果
- ✅ 表格包含4列：版本ID、版本文件名、备注、操作
- ✅ 版本ID列宽度100px，固定在左侧
- ✅ 版本文件名列宽度500px，每个文件独立一行
- ✅ 文件名前显示绿色 Excel 图标
- ✅ 文件信息显示格式：`文件名 (大小 KB, 用例数 条用例)`
- ✅ 备注列显示"点击添加备注..."提示文字（如无备注）
- ✅ 操作列包含"下载"和"删除"按钮

### 验证点
- 列表按创建时间倒序排列（最新版本在最前）
- 分页功能正常（每页10条记录）
- 表格横向滚动条出现（总宽度1300px）

---

## 测试场景 3: 下载版本压缩包

### 操作步骤
1. 在版本列表中点击某个版本的"下载"按钮

### 预期结果
- ✅ 显示 loading 提示"正在准备下载..."
- ✅ 浏览器触发文件下载
- ✅ 下载的文件名格式：`版本ID.zip`
- ✅ 下载完成后显示 success 提示"下载成功"

### 验证点
- 解压zip文件后包含4个Excel文件（role1-4.xlsx）
- 每个Excel文件可正常打开
- Excel文件包含19列：ID, CaseNumber, Screen/Function/Precondition/TestSteps/ExpectedResult (CN/JP/EN), TestResult, Remark
- 数据完整性：用例数量与列表显示一致

### 性能要求
- 1000条用例以内，下载准备时间 < 5秒
- 5000条用例，下载准备时间 < 15秒

---

## 测试场景 4: 备注编辑

### 操作步骤
1. 点击备注列的空白区域或现有备注文字
2. 输入备注内容（例如："v1.0 基线版本"）
3. 按 Enter 键或点击"保存"按钮

### 预期结果
- ✅ 备注区域变为输入框
- ✅ 输入框右侧显示"保存"和"取消"按钮
- ✅ 输入框最大长度200字符
- ✅ 点击保存后显示 success 提示"备注更新成功"
- ✅ 备注文字更新为新内容
- ✅ 编辑状态退出，恢复为点击编辑模式

### 边界测试
- 输入199字符：正常保存
- 输入200字符：正常保存
- 输入201字符：只保留前200字符
- 空白备注：保存后显示"点击添加备注..."

### 验证点
- 点击取消按钮：输入框关闭，备注恢复为原值
- 编辑时点击其他行备注：当前编辑自动取消

---

## 测试场景 5: 删除版本

### 操作步骤
1. 点击某个版本的"删除"按钮
2. 在弹出的确认对话框中点击"确定"

### 预期结果
- ✅ 显示确认对话框，标题"确定删除此版本吗？"
- ✅ 描述文字"删除后无法恢复"
- ✅ 确认按钮"确定"，取消按钮"取消"
- ✅ 点击确定后显示 success 提示"删除成功"
- ✅ 版本从列表中移除
- ✅ 总数和分页信息更新

### 验证点
- 点击取消按钮：对话框关闭，版本未删除
- 物理文件删除：检查 storage/versions/auto-cases/ 目录，对应4个文件已删除
- 数据库记录删除：auto_test_case_versions 表中对应4条记录已删除

---

## 测试场景 6: 并发版本保存

### 操作步骤
1. ROLE1 Tab 点击"保存版本"
2. 等待1秒
3. ROLE2 Tab 点击"保存版本"（如果有保存按钮）

### 预期结果
- ✅ 两次保存生成不同的 version_id（时间戳不同）
- ✅ 两个版本分别包含4个文件
- ✅ 列表中显示2个版本记录

### 验证点
- 文件路径不冲突
- 数据库记录完整性
- 文件命名唯一性

---

## 测试场景 7: 空数据处理

### 操作步骤
1. 创建一个新项目，不添加任何自动化测试用例
2. 在 ROLE1 Tab 点击"保存版本"

### 预期结果
- ✅ 显示 error 提示"没有可导出的用例"（如果后端有此验证）
- ✅ 或成功保存，但文件中只有表头，用例数为0

### 验证点
- 不生成空文件（0字节）
- 错误提示友好

---

## 测试场景 8: 分页功能

### 操作步骤
1. 保存11个版本（多次点击保存版本按钮）
2. 在版本管理列表中观察分页器

### 预期结果
- ✅ 第1页显示10条记录
- ✅ 第2页显示1条记录
- ✅ 总数显示11
- ✅ 切换页码后数据正确加载

### 验证点
- 分页器位置正确（表格底部右侧）
- 每页记录数可配置（默认10条）

---

## 测试场景 9: 权限验证

### 操作步骤
1. 使用非 PM/PM Member 角色登录
2. 访问版本管理 Tab

### 预期结果
- ✅ ROLE1 Tab 不显示"保存版本"按钮（如果有权限控制）
- ✅ 或点击保存版本后返回403错误

### 验证点
- 后端API返回403状态码
- 前端显示权限不足提示

---

## 测试场景 10: 网络异常处理

### 操作步骤
1. 断开网络或停止后端服务
2. 点击"保存版本"按钮
3. 或点击"下载"/"删除"按钮

### 预期结果
- ✅ 显示 error 提示"操作失败"或"网络错误"
- ✅ 按钮恢复可用状态（loading结束）
- ✅ 列表数据不受影响

### 验证点
- 错误提示清晰
- 不出现白屏或崩溃

---

## 性能测试

### 大数据量测试
- **500条用例**: 保存版本 < 3秒，下载 < 5秒
- **1000条用例**: 保存版本 < 5秒，下载 < 8秒
- **5000条用例**: 保存版本 < 10秒，下载 < 20秒

### 并发测试
- 同时10个用户保存版本：无数据错乱，文件路径无冲突

---

## 回归测试清单

完成版本管理功能后，验证以下功能未受影响：
- ✅ 自动化测试用例的增删改查
- ✅ 用例拖拽排序
- ✅ 多语言切换
- ✅ 用例批量删除
- ✅ 用例导入导出（如果之前存在）

---

## 测试结果记录

| 场景编号 | 场景名称 | 测试结果 | 备注 |
|---------|---------|---------|------|
| 1 | 版本保存与自动跳转 | ⬜ PASS / ⬜ FAIL | |
| 2 | 版本列表展示 | ⬜ PASS / ⬜ FAIL | |
| 3 | 下载版本压缩包 | ⬜ PASS / ⬜ FAIL | |
| 4 | 备注编辑 | ⬜ PASS / ⬜ FAIL | |
| 5 | 删除版本 | ⬜ PASS / ⬜ FAIL | |
| 6 | 并发版本保存 | ⬜ PASS / ⬜ FAIL | |
| 7 | 空数据处理 | ⬜ PASS / ⬜ FAIL | |
| 8 | 分页功能 | ⬜ PASS / ⬜ FAIL | |
| 9 | 权限验证 | ⬜ PASS / ⬜ FAIL | |
| 10 | 网络异常处理 | ⬜ PASS / ⬜ FAIL | |

---

## 已知问题与风险

1. **文件路径安全**: 下载时需验证 version_id 格式，防止路径遍历攻击
2. **存储空间**: 长期运行需定期清理旧版本，避免磁盘占满
3. **并发冲突**: 相同时间戳（秒级）保存可能导致 version_id 冲突
4. **大文件下载**: 5000+用例时zip文件可能超过10MB，需优化流式传输

---

## 测试完成标准

- ✅ 所有10个测试场景均通过
- ✅ 性能测试达标
- ✅ 无阻塞性Bug
- ✅ 代码审查通过
- ✅ 文档齐全（API文档、用户指南）
