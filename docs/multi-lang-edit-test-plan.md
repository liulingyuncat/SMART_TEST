# 多语言编辑对话框测试计划

## 功能概述
根据需求文档 FR-03.2，实现了整体用例和变更用例的多语言编辑功能。

## 实现详情

### 1. 新增组件
- **MultiLangEditModal.jsx**: 多语言编辑对话框组件
  - 支持同时编辑中文(CN)、日文(JP)、英文(EN)三种语言
  - 根据字段类型自动选择输入组件(Input/TextArea)
  - 表单验证: 文本字段最大100字符，文本域最大2000字符

### 2. EditableTable 修改
- **字段列定义重构**:
  - AI用例: 使用单语言字段 (major_function, middle_function, etc.)
  - 整体/变更用例: 使用多语言字段 (major_function_cn/jp/en)
  
- **编辑模式区分**:
  - 中文模式 + 整体/变更用例:
    - 点击字段内容 → 打开多语言对话框
    - 操作列只显示"删除"按钮
  - 日文/英文模式 + 整体/变更用例:
    - 显示对应语言字段
    - 点击"编辑"按钮 → 行内编辑
    - 操作列显示"编辑"+"删除"按钮
  - AI用例:
    - 始终使用行内编辑
    - 操作列显示"编辑"+"删除"按钮

## 测试步骤

### 测试环境准备
1. 启动后端服务器 (端口8080)
2. 启动前端开发服务器 (端口3000)
3. 登录系统并进入项目详情页

### 测试用例 1: 中文模式 - 整体用例多语言编辑
**前置条件**: 选择"整体用例"tab，语言选择"中文"

**步骤**:
1. 点击任意用例的"大功能"字段内容
2. 验证弹出多语言编辑对话框
3. 验证对话框标题显示为"编辑大功能分类"
4. 验证显示三个输入框: 中文(CN)、日文(JP)、英文(EN)
5. 修改三个语言的内容
6. 点击"保存"按钮
7. 验证保存成功提示
8. 验证表格中中文字段已更新

**预期结果**:
- 对话框正常弹出并显示当前数据
- 三个语言字段可以独立编辑
- 保存后所有三个语言的数据都更新到数据库
- 表格显示更新后的中文内容

### 测试用例 2: 中文模式 - 测试步骤字段编辑
**前置条件**: 选择"整体用例"tab，语言选择"中文"

**步骤**:
1. 点击任意用例的"测试步骤"字段内容
2. 验证弹出多语言编辑对话框
3. 验证输入框类型为TextArea(多行文本)
4. 输入较长文本(>100字符)测试TextArea显示
5. 尝试输入>2000字符的文本
6. 验证字符数限制提示
7. 修改为有效长度并保存

**预期结果**:
- 对话框使用TextArea组件显示
- 支持多行文本输入
- 超过2000字符时显示验证错误
- 有效数据成功保存

### 测试用例 3: 日文模式 - 行内编辑
**前置条件**: 选择"整体用例"tab，语言选择"日本語"

**步骤**:
1. 验证表格列标题显示为JP后缀 (Maj.CategoryJP, Mid.CategoryJP等)
2. 验证操作列显示"编辑"和"删除"两个按钮
3. 点击任意用例的"编辑"按钮
4. 验证该行进入编辑状态
5. 修改日文字段内容
6. 点击"保存"按钮
7. 验证只更新了日文字段，中文和英文字段不变

**预期结果**:
- 列标题正确显示JP后缀
- 点击字段内容不弹出对话框
- 行内编辑功能正常
- 只更新当前语言的字段

### 测试用例 4: 英文模式 - 行内编辑
**前置条件**: 选择"整体用例"tab，语言选择"English"

**步骤**:
1. 验证表格列标题显示为EN后缀 (Maj.CategoryEN, Mid.CategoryEN等)
2. 验证操作列显示"编辑"和"删除"两个按钮
3. 点击任意用例的"编辑"按钮
4. 验证该行进入编辑状态
5. 修改英文字段内容
6. 点击"保存"按钮
7. 验证只更新了英文字段

**预期结果**:
- 列标题正确显示EN后缀
- 行内编辑功能正常
- 只更新英文字段

### 测试用例 5: 中文模式 - 操作列验证
**前置条件**: 选择"整体用例"tab，语言选择"中文"

**步骤**:
1. 验证操作列只显示"删除"按钮
2. 验证不显示"编辑"按钮
3. 点击"删除"按钮
4. 验证删除确认对话框
5. 确认删除
6. 验证用例被删除

**预期结果**:
- 操作列只有"删除"按钮
- 删除功能正常工作

### 测试用例 6: 变更用例多语言编辑
**前置条件**: 选择"变更用例"tab，语言选择"中文"

**步骤**:
1. 验证功能与整体用例相同
2. 点击字段弹出多语言对话框
3. 编辑并保存
4. 切换到日文/英文模式验证行内编辑

**预期结果**:
- 变更用例与整体用例行为一致
- 所有多语言功能正常工作

### 测试用例 7: AI用例验证
**前置条件**: 选择"AI用例"tab

**步骤**:
1. 验证列标题使用单语言字段 (Maj.Category, Mid.Category等)
2. 验证操作列显示"编辑"和"删除"按钮
3. 点击"编辑"按钮进入行内编辑
4. 验证点击字段内容不弹出对话框

**预期结果**:
- AI用例不使用多语言字段
- 始终使用行内编辑
- 不弹出多语言对话框

### 测试用例 8: 编辑状态下字段点击
**前置条件**: 选择"整体用例"tab，语言选择"中文"

**步骤**:
1. 点击用例A的"编辑"按钮(如果在非中文模式)
2. 尝试点击用例B的字段内容
3. 验证是否阻止打开对话框

**预期结果**:
- 编辑状态下不能打开多语言对话框
- 需要先保存或取消当前编辑

### 测试用例 9: 表单验证
**前置条件**: 选择"整体用例"tab，语言选择"中文"

**步骤**:
1. 点击任意字段打开多语言对话框
2. 在文本字段(大/中/小功能)输入>100字符
3. 尝试保存
4. 验证验证错误提示
5. 在TextArea字段(前置条件/测试步骤/期待值)输入>2000字符
6. 尝试保存
7. 验证验证错误提示

**预期结果**:
- 文本字段限制100字符
- TextArea字段限制2000字符
- 显示明确的验证错误信息

## 数据库验证

### 验证多语言字段存储
在保存多语言数据后，使用数据库工具查询:

```sql
SELECT 
  id,
  major_function_cn,
  major_function_jp,
  major_function_en,
  middle_function_cn,
  middle_function_jp,
  middle_function_en
FROM manual_test_cases
WHERE id = [测试用例ID];
```

**预期结果**:
- _cn、_jp、_en 三个字段都有正确的值
- 值与对话框中输入的内容一致

## 已知限制
1. AI用例不支持多语言编辑(按需求设计)
2. 编辑状态下无法打开多语言对话框(防止冲突)
3. 字段验证限制:
   - 文本字段: 最大100字符
   - TextArea字段: 最大2000字符

## 修复的问题
1. ✅ 列定义语法错误(缺少const声明)
2. ✅ React Hooks依赖警告(使用useCallback包装函数)
3. ✅ 操作列逻辑根据语言和用例类型动态显示
4. ✅ 字段点击事件只在中文模式触发

## 代码变更汇总
- 新增文件: `frontend/src/pages/ProjectDetail/ManualTestTabs/components/MultiLangEditModal.jsx`
- 修改文件: `frontend/src/pages/ProjectDetail/ManualTestTabs/components/EditableTable.jsx`
  - 添加MultiLangEditModal组件引入
  - 添加modal状态管理(multiLangModalVisible, multiLangData)
  - 添加openMultiLangModal和handleMultiLangSave函数
  - 重构列定义逻辑(区分AI/Overall/Change + 中文/日文/英文)
  - 修改操作列逻辑(中文模式只显示删除按钮)
  - 使用useCallback优化函数性能
