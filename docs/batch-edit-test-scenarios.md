# 批量修改功能测试场景

## 匹配逻辑说明

### 当前实现逻辑

当用户修改大功能或中功能时，系统会：

1. **获取原始值**：修改前的 CN、JP、EN 三个语言字段的值
2. **获取新值**：用户在对话框中输入的新值
3. **查找匹配用例**：在所有用例中查找与**原始值完全相同**的用例（三个语言字段都要匹配）
4. **弹出确认对话框**：如果找到匹配用例，询问用户是否批量修改
5. **批量更新**：使用**新值（CN/JP/EN）**更新所有匹配的用例

### 关键点

✅ **匹配条件**：三个语言字段（CN、JP、EN）都与当前用例的原始值相同  
✅ **更新内容**：无论用户修改了哪个语言，都会同时更新 CN、JP、EN 三个字段  
✅ **包含范围**：当前用例 + 所有匹配的用例

## 测试场景

### 场景1：修改CN，EN/JP保持不变

**数据准备**：
```
用例1: CN="登录", JP="ログイン", EN="Login"
用例2: CN="登录", JP="ログイン", EN="Login"  (匹配)
用例3: CN="登录", JP="ログイン", EN="Login"  (匹配)
用例4: CN="注销", JP="ログアウト", EN="Logout" (不匹配)
```

**操作步骤**：
1. 点击用例1的"大功能"字段
2. 修改 CN 为"登录功能"
3. JP 和 EN 保持不变
4. 点击"保存"

**期望结果**：
- ✅ 弹出批量修改确认对话框
- ✅ 显示"检测到有 2 条用例的大功能与当前值相同"
- ✅ 点击"批量修改"后：
  - 用例1: CN="登录功能", JP="ログイン", EN="Login"
  - 用例2: CN="登录功能", JP="ログイン", EN="Login"
  - 用例3: CN="登录功能", JP="ログイン", EN="Login"
  - 用例4: 保持不变

### 场景2：同时修改CN、JP、EN

**数据准备**：
```
用例1: CN="登录", JP="ログイン", EN="Login"
用例2: CN="登录", JP="ログイン", EN="Login"  (匹配)
用例3: CN="登录", JP="ログイン", EN="Login"  (匹配)
```

**操作步骤**：
1. 点击用例1的"大功能"字段
2. 修改 CN 为"用户登录"
3. 修改 JP 为"ユーザーログイン"
4. 修改 EN 为"User Login"
5. 点击"保存"

**期望结果**：
- ✅ 弹出批量修改确认对话框
- ✅ 显示"检测到有 2 条用例"
- ✅ 点击"批量修改"后，所有三个用例的 CN、JP、EN 都更新为新值

### 场景3：只修改JP，CN/EN保持不变

**数据准备**：
```
用例1: CN="登录", JP="ログイン", EN="Login"
用例2: CN="登录", JP="ログイン", EN="Login"  (匹配)
```

**操作步骤**：
1. 点击用例1的"大功能"字段
2. CN 和 EN 保持不变
3. 修改 JP 为"サインイン"
4. 点击"保存"

**期望结果**：
- ✅ 弹出批量修改确认对话框
- ✅ 点击"批量修改"后：
  - 用例1: CN="登录", JP="サインイン", EN="Login"
  - 用例2: CN="登录", JP="サインイン", EN="Login"

### 场景4：修改EN，CN/JP保持不变

**测试步骤**：与场景3相同，只是修改 EN 字段

**期望结果**：同样会弹出批量修改确认对话框

### 场景5：没有匹配的用例

**数据准备**：
```
用例1: CN="登录", JP="ログイン", EN="Login"
用例2: CN="注销", JP="ログアウト", EN="Logout" (不匹配)
```

**操作步骤**：
1. 点击用例1的"大功能"字段
2. 修改任意语言字段
3. 点击"保存"

**期望结果**：
- ✅ 不弹出批量修改确认对话框
- ✅ 直接保存，只更新当前用例

### 场景6：部分匹配（测试严格匹配）

**数据准备**：
```
用例1: CN="登录", JP="ログイン", EN="Login"
用例2: CN="登录", JP="ログイン", EN="Sign In" (不匹配，EN不同)
用例3: CN="登录", JP="サインイン", EN="Login" (不匹配，JP不同)
```

**操作步骤**：
1. 点击用例1的"大功能"字段
2. 修改 CN 为"用户登录"
3. 点击"保存"

**期望结果**：
- ✅ 不弹出批量修改确认对话框
- ✅ 只更新用例1（因为用例2和用例3与用例1的原始值不完全相同）

### 场景7：仅修改当前用例

**数据准备**：
```
用例1: CN="登录", JP="ログイン", EN="Login"
用例2: CN="登录", JP="ログイン", EN="Login"  (匹配)
```

**操作步骤**：
1. 点击用例1的"大功能"字段
2. 修改 CN 为"用户登录"
3. 点击"保存"
4. 在批量修改确认对话框中点击"仅修改当前"

**期望结果**：
- ✅ 只更新用例1
- ✅ 用例2保持不变

## 调试日志示例

### 正常匹配的日志

```
原始值 CN: 登录 JP: ログイン EN: Login
新值 CN: 用户登录 JP: ユーザーログイン EN: User Login
字段变化: {cnChanged: true, jpChanged: true, enChanged: true}
匹配的用例数量: 2
匹配的用例 case_id: [2, 3]
匹配用例详情:
  1. case_id: 2, CN: 登录, JP: ログイン, EN: Login
  2. case_id: 3, CN: 登录, JP: ログイン, EN: Login
🚀 发现匹配用例，弹出批量修改确认对话框
```

### 部分匹配（不会触发批量修改）

```
原始值 CN: 登录 JP: ログイン EN: Login
新值 CN: 用户登录 JP: ログイン EN: Login
字段变化: {cnChanged: true, jpChanged: false, enChanged: false}
匹配的用例数量: 0
(因为其他用例的 JP 或 EN 与当前用例不同)
没有匹配的用例，直接保存
```

## 常见问题

### Q1: 为什么修改EN没有弹出对话框？

**A**: 检查以下几点：
1. 是否有其他用例与当前用例的 CN、JP、EN **三个字段都相同**？
2. 如果只有部分字段相同，不会触发批量修改

### Q2: 为什么前面的用例没有被修改？

**A**: 可能原因：
1. 前面的用例与当前用例的三个语言字段不完全相同
2. 查看控制台日志，确认"匹配的用例 case_id"列表中是否包含前面的用例

### Q3: 如何确保所有相同的用例都被找到？

**A**: 
1. 打开控制台查看日志
2. 检查"获取到的所有用例数量"是否正确
3. 检查"匹配的用例数量"和"匹配的用例 case_id"列表

## 测试检查清单

测试前确认：
- [ ] 数据库中有测试数据（至少3条大功能相同的用例）
- [ ] 浏览器控制台已打开
- [ ] 已刷新页面加载最新代码

测试步骤：
- [ ] 测试修改CN字段
- [ ] 测试修改JP字段
- [ ] 测试修改EN字段
- [ ] 测试同时修改多个字段
- [ ] 测试"批量修改"功能
- [ ] 测试"仅修改当前"功能
- [ ] 验证没有匹配用例时直接保存

验证点：
- [ ] 对话框正常显示
- [ ] 匹配用例数量正确
- [ ] 批量修改后所有用例都更新
- [ ] CN、JP、EN三个字段都正确更新
- [ ] 不匹配的用例不受影响

---

**最后更新**: 2025-11-25
